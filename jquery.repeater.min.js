(function(n){"use strict";var s=function(n){if(typeof n=="object")for(var t in n)return n[t];return n},i=function(t){return n.isArray(t)},f=function(n){return!i(n)&&n instanceof Object},b=function(n){return n instanceof Number},k=function(n){return n instanceof Function},e=function(t,i){return n.inArray(i,t)},h=function(n,t){return e(n,t)!==-1},t=function(n,t){for(var i in n)n.hasOwnProperty(i)&&t(n[i],i,n)},o=function(n){return n[n.length-1]},c=function(n){return Array.prototype.slice.call(n)},l=function(){var n={};return t(c(arguments),function(i){t(i,function(t,i){n[i]=t})}),n},a=function(n,i){var r=[];return t(n,function(n,t,u){r.push(i(n,t,u))}),r},v=function(n,i,r){var u={};return t(n,function(n,t,f){if(typeof n=="object")for(var e in n)t=t+"."+e;t=r?r(t,n):t;u[t]=i(n,t,f)}),u},r=function(n,t,r){return i(n)?a(n,t):v(n,t,r)},y=function(n,t){return r(n,function(n){return n[t]})},p=function(n,r){var u;return i(n)?(u=[],t(n,function(n,t,i){if(typeof n=="object")for(var f in n)r(n[f],t+"."+f,i)&&u.push(n[f]);else r(n,t,i)&&u.push(n)})):(u={},t(n,function(n,t,f){if(typeof n=="object")for(var e in n)i(n[e])?n[e].forEach(function(n,i){r(n,t+"."+e,f)&&(u[t+"."+e+"."+i]=n)}):r(n[e],t+"."+e,f)&&(u[t+"."+e]=n[e]);else r(n,t,f)&&(u[t]=n)})),u},u=function(n,t,i){return r(n,function(n){return n[t].apply(n,i||[])})},d=function(n,t){var i=null;return function(){var r=this,u=arguments;i===null&&(i=setTimeout(function(){i=null},n),t.apply(r,u))}},w=function(n){n=n||{};var i={};return n.publish=function(n,r){t(i[n],function(n){n(r)})},n.subscribe=function(n,t){i[n]=i[n]||[];i[n].push(t)},n.unsubscribe=function(n){t(i,function(t){var i=e(t,n);i!==-1&&t.splice(i,1)})},n};(function(n){var l=function(n,t){var i=w(),r=n.$;return i.getType=function(){throw'implement me (return type. "text", "radio", etc.)';},i.$=function(n){return n?r.find(n):r},i.disable=function(){i.$().prop("disabled",!0);i.publish("isEnabled",!1)},i.enable=function(){i.$().prop("disabled",!1);i.publish("isEnabled",!0)},t.equalTo=function(n,t){return n===t},t.publishChange=function(){var n;return function(r,u){var f=i.get();t.equalTo(f,n)||i.publish("change",{e:r,domElement:u});n=f}}(),i},r=function(n,t){var i=l(n,t);return i.get=function(){return i.$().val()},i.set=function(n){i.$().val(n)},i.clear=function(){i.set("")},t.buildSetter=function(n){return function(t){n.call(i,t)}},i},a=function(n,r){n=i(n)?n:[n];r=i(r)?r:[r];var u=!0;return n.length!==r.length?u=!1:t(n,function(n){h(r,n)||(u=!1)}),u},v=function(n){var i={},t=r(n,i);t.getType=function(){return"button"};t.$().on("change",function(n){i.publishChange(n,this)});return t},y=function(u){var e={},f=r(u,e);return f.getType=function(){return"checkbox"},f.get=function(){var t=[];return f.$().filter(":checked").each(function(){t.push(n(this).val())}),t},f.set=function(r){r=i(r)?r:[r];f.$().each(function(){n(this).prop("checked",!1)});t(r,function(n){f.$().filter('[value="'+n+'"]').prop("checked",!0)})},e.equalTo=a,f.$().change(function(n){e.publishChange(n,this)}),f},p=function(n){var t=c(n,{});return t.getType=function(){return"email"},t},b=function(t){var r={},i=l(t,r);return i.getType=function(){return"file"},i.get=function(){return o(i.$().val().split("\\"))},i.clear=function(){this.$().each(function(){n(this).wrap("<form>").closest("form").get(0).reset();n(this).unwrap()})},i.$().change(function(n){r.publishChange(n,this)}),i},k=function(n){var i={},t=r(n,i);return t.getType=function(){return"hidden"},t.$().change(function(n){i.publishChange(n,this)}),t},d=function(t){var r={},i=l(t,r);return i.getType=function(){return"file[multiple]"},i.get=function(){for(var t=i.$().get(0).files||[],r=[],n=0;n<(t.length||0);n+=1)r.push(t[n].name);return r},i.clear=function(){this.$().each(function(){n(this).wrap("<form>").closest("form").get(0).reset();n(this).unwrap()})},i.$().change(function(n){r.publishChange(n,this)}),i},g=function(n){var u={},t=r(n,u);return t.getType=function(){return"select[multiple]"},t.get=function(){return t.$().val()||[]},t.set=function(n){t.$().val(n===""?[]:i(n)?n:[n])},u.equalTo=a,t.$().change(function(n){u.publishChange(n,this)}),t},nt=function(n){var t=c(n,{});return t.getType=function(){return"password"},t},tt=function(t){var u={},i=r(t,u);return i.getType=function(){return"radio"},i.get=function(){return i.$().filter(":checked").val()||null},i.set=function(t){t?i.$().filter('[value="'+t+'"]').prop("checked",!0):i.$().each(function(){n(this).prop("checked",!1)})},i.$().change(function(n){u.publishChange(n,this)}),i},it=function(n){var i={},t=r(n,i);return t.getType=function(){return"range"},t.$().change(function(n){i.publishChange(n,this)}),t},rt=function(n){var i={},t=r(n,i);return t.getType=function(){return"select"},t.$().change(function(n){i.publishChange(n,this)}),t},c=function(n){var i={},t=r(n,i);t.getType=function(){return"text"};t.$().on("change keyup keydown",function(n){i.publishChange(n,this)});return t},ut=function(n){var i={},t=r(n,i);t.getType=function(){return"textarea"};t.$().on("change keyup keydown",function(n){i.publishChange(n,this)});return t},ft=function(n){var t=c(n,{});return t.getType=function(){return"url"},t},s=function(i){var o={},r=i.$,h=i.constructorOverride||{button:v,text:c,url:ft,email:p,password:nt,range:it,textarea:ut,select:rt,"select[multiple]":g,radio:tt,checkbox:y,file:b,"file[multiple]":d,hidden:k},u=function(t,i){var u=f(i)?i:r.find(i);u.each(function(){var i=n(this).attr("name");o[i]=h[t]({$:n(this)})})},s=function(i,u){var s=[],c=f(u)?u:r.find(u);f(u)?o[c.attr("name")]=h[i]({$:c}):(c.each(function(){e(s,n(this).attr("name"))===-1&&s.push(n(this).attr("name"))}),t(s,function(n){o[n]=h[i]({$:r.find('input[name="'+n+'"]')})}))};return r.is("input, select, textarea")?r.is('input[type="button"], button, input[type="submit"]')?u("button",r):r.is("textarea")?u("textarea",r):r.is('input[type="text"]')||r.is("input")&&!r.attr("type")?u("text",r):r.is('input[type="password"]')?u("password",r):r.is('input[type="email"]')?u("email",r):r.is('input[type="url"]')?u("url",r):r.is('input[type="range"]')?u("range",r):r.is("select")?r.is("[multiple]")?u("select[multiple]",r):u("select",r):r.is('input[type="file"]')?r.is("[multiple]")?u("file[multiple]",r):u("file",r):r.is('input[type="hidden"]')?u("hidden",r):r.is('input[type="radio"]')?s("radio",r):r.is('input[type="checkbox"]')?s("checkbox",r):u("text",r):(u("button",'input[type="button"], button, input[type="submit"]'),u("text",'input[type="text"]'),u("password",'input[type="password"]'),u("email",'input[type="email"]'),u("url",'input[type="url"]'),u("range",'input[type="range"]'),u("textarea","textarea"),u("select","select:not([multiple])"),u("select[multiple]","select[multiple]"),u("file",'input[type="file"]:not([multiple])'),u("file[multiple]",'input[type="file"][multiple]'),u("hidden",'input[type="hidden"]'),s("radio",'input[type="radio"]'),s("checkbox",'input[type="checkbox"]')),o};n.fn.inputVal=function(i){var r=n(this),f=s({$:r});return r.is("input, textarea, select")?typeof i=="undefined"?f[r.attr("name")].get():(f[r.attr("name")].set(i),r):typeof i=="undefined"?u(f,"get"):(t(i,function(n,t){f[t].set(n)}),r)};n.fn.inputOnChange=function(i){var r=n(this),u=s({$:r});return t(u,function(n){n.subscribe("change",function(n){i.call(n.domElement,n.e)})}),r};n.fn.inputDisable=function(){var t=n(this);return u(s({$:t}),"disable"),t};n.fn.inputEnable=function(){var t=n(this);return u(s({$:t}),"enable"),t};n.fn.inputClear=function(){var t=n(this);return u(s({$:t}),"clear"),t}})(jQuery);n.fn.repeaterVal=function(){var u=function(n){var i=[];return t(n,function(n,t){console.log("parse",t,n);var u=[];t!=="undefined"&&(u.push(t.match(/^[^\[]*/)[0]),u=u.concat(r(t.match(/\[[^\]]*\]/g),function(n){return n.replace(/[\[\]]/g,"")})),i.push({val:n,key:u}))}),i},i=function(n){if(n.length===1&&(n[0].key.length===0||n[0].key.length===1&&!n[0].key[0]))return n[0].val;t(n,function(n){n.head=n.key.shift()});var u=function(){var i={};return t(n,function(n){i[n.head]||(i[n.head]=[]);i[n.head].push(n)}),i}(),r;return/^[0-9]+$/.test(n[0].head)?(r=[],t(u,function(n){r.push(i(n))})):(r={},t(u,function(n,t){r[t]=i(n)})),r};return i(u(n(this).inputVal()))};n.fn.repeater=function(i){i=i||{};var u;return n(this).each(function(){var w=n(this),nt=i.show||function(){n(this).show()},tt=i.hide||function(n){n()},h=w.find("[data-repeater-list]").first(),f=function(t,i){return t.filter(function(){return i?n(this).closest(y(i,"selector").join(",")).length===0:!0})},e=function(){return f(h.find("[data-repeater-item]"),i.repeaters)},it=h.find("[data-repeater-item]").first().clone().hide(),b=f(f(n(this).find("[data-repeater-item]"),i.repeaters).first().find("[data-repeater-delete]"),i.repeaters),g,v;i.isFirstItemUndeletable&&b&&b.remove();var a=function(){var n=h.data("repeater-list");return i.$parent?i.$parent.data("item-name")+"["+n+"]":n},k=function(r){i.repeaters&&r.each(function(){var r=n(this);t(i.repeaters,function(n){r.find(n.selector).repeater(l(n,{$parent:r}))})})},d=function(n,i,r){n&&t(n,function(n){r.call(i.find(n.selector)[0],n)})},c=function(t,i,r){t.each(function(t){var u=n(this);u.data("item-name",i+"["+t+"]");f(u.find("[name]"),r).each(function(){var e=n(this),s=e.attr("name").match(/\[[^\]]+\]/g),h=s?o(s).replace(/\[|\]/g,""):e.attr("name"),l=i+"["+t+"]["+h+"]"+(e.is(":checkbox")||e.attr("multiple")?"[]":"");e.attr("name",l);d(r,u,function(r){var u=n(this);c(f(u.find("[data-repeater-item]"),r.repeaters||[]),i+"["+t+"]["+u.find("[data-repeater-list]").first().data("repeater-list")+"]",r.repeaters)})})});h.find("input[name][checked]").removeAttr("checked").prop("checked",!0)};c(e(),a(),i.repeaters);k(e());i.initEmpty&&e().remove();i.ready&&i.ready(function(){c(e(),a(),i.repeaters)});g=function(){var u=function(e,o,h){if(o||i.defaultValues){var c={};f(e.find("[name]"),h).each(function(){var t=n(this).attr("name").match(/\[([^\]]*)(\]|\]\[\])$/)[1];c[t]=n(this).attr("name")});e.inputVal(r(p(o||i.defaultValues,function(n,t){if(typeof n=="object")for(var i in n)return c[t+"."+i];return c[t]}),s,function(n){return c[n]}))}d(h,e,function(i){var r=n(this);f(r.find("[data-repeater-item]"),i.repeaters).each(function(){var f=r.find("[data-repeater-list]").data("repeater-list"),e;o&&o[f]?(e=n(this).clone(),r.find("[data-repeater-item]").remove(),t(o[f],function(n){var t=e.clone();u(t,n,i.repeaters||[]);r.find("[data-repeater-list]").append(t)})):o&&f.indexOf(".")>0?(e=n(this).clone(),r.find("[data-repeater-item]").remove(),t(eval("data."+f),function(n){var t=e.clone();u(t,n,i.repeaters||[]);r.find("[data-repeater-list]").append(t)})):u(n(this),i.defaultValues,i.repeaters||[])})})};return function(t,r){h.append(t);c(e(),a(),i.repeaters);t.find("[name]").each(function(){n(this).inputClear()});u(t,r||i.defaultValues,i.repeaters)}}();v=function(n){var t=it.clone();g(t,n);i.repeaters&&k(t);nt.call(t.get(0))};u=function(n){e().remove();t(n,v)};f(w.find("[data-repeater-create]"),i.repeaters).click(function(){v()});h.on("click","[data-repeater-delete]",function(){var t=n(this).closest("[data-repeater-item]").get(0);tt.call(t,function(){n(t).remove();c(e(),a(),i.repeaters)})})}),this.setList=u,this}})(jQuery);